<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senkufie Music Showroom</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ==================================== */
        /* CSS STYLES (Normally in style.css)   */
        /* ==================================== */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a; /* Dark charcoal background */
            color: #F8F8F8; /* Light off-white text */
            overflow-x: hidden;
        }
        .page-content {
            display: none;
            min-height: calc(100vh - 80px); /* Adjust for header height */
            padding-top: 80px;
        }
        .cinzel-font {
            font-family: 'Cinzel', serif;
        }
        .active-link {
            border-bottom: 2px solid #FFD700; /* Gold accent */
        }
        .gold-gradient {
            background: linear-gradient(135deg, #FFD700, #C9A800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.2);
            transition: all 0.3s ease-in-out;
        }
        /* Hide scrollbar for carousel and top nav on most browsers */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #FFD700; /* Gold */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Navigation -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-black/50 backdrop-blur-sm shadow-lg">
        <nav class="container mx-auto flex items-center justify-between p-4 px-6 md:px-12">
            <a href="#" class="text-3xl font-bold cinzel-font text-white tracking-widest">
                SENKUFIE
            </a>
            <div class="space-x-8">
                <a href="#" class="nav-link text-white hover:text-yellow-500 transition-colors duration-300 active-link" onclick="showPage('home-page', this)">Home</a>
                <a href="#" class="nav-link text-white hover:text-yellow-500 transition-colors duration-300" onclick="showPage('shop-page', this)">Shop</a>
                <a href="#" class="nav-link text-white hover:text-yellow-500 transition-colors duration-300" onclick="showPage('contact-page', this)">Contact</a>
            </div>
        </nav>
    </header>

    <!-- Page Containers -->

    <!-- ==================================== -->
    <!-- 1. HOME PAGE CONTENT -->
    <!-- ==================================== -->
    <div id="home-page" class="page-content block">
        <!-- Hero Section -->
        <section class="min-h-screen flex items-center justify-center bg-[url('https://t3.ftcdn.net/jpg/00/10/11/90/360_F_10119006_JjlCbu7xGu93URdQRU7cxbXtqMbDDGEN.jpg')] bg-cover bg-center bg-no-repeat relative">
            <div class="absolute inset-0 bg-black/70"></div>
            <div class="relative z-10 text-center px-6 fade-in">
                <h1 class="text-6xl md:text-8xl font-black cinzel-font tracking-tighter leading-none gold-gradient mb-4 drop-shadow-xl">
                    THE STAGE IS YOURS
                </h1>
                <p class="text-xl md:text-3xl font-light text-gray-200 max-w-2xl mx-auto mb-8">
                    Dealers in Top Brands of Musical Instruments and Accessories.
                </p>
                <a href="#" onclick="showPage('shop-page', document.querySelector('.nav-link:nth-child(2)'))" class="inline-block px-8 py-4 text-lg font-bold text-white bg-yellow-600 rounded-full shadow-lg hover:bg-white hover:text-black transition-all duration-300 hover-lift">
                    EXPLORE THE COLLECTION
                </a>
            </div>
        </section>

        <!-- Our Story Section -->
        <section class="container mx-auto py-24 px-6 md:px-12">
            <div class="text-center fade-in">
                <h2 class="text-5xl font-bold cinzel-font gold-gradient mb-6">Our Legacy</h2>
                <p class="text-lg text-gray-400 max-w-3xl mx-auto leading-relaxed">
                    Since 1985, Senkufie Music has been dedicated to empowering musicians of all levels with the finest instruments and gear. We believe that music is a universal language, and our mission is to provide the tools that allow every artist to speak their truth. Our curated collection features top brands known for their craftsmanship, tone, and durability.
                </p>
            </div>
            <div class="mt-16 grid md:grid-cols-3 gap-8 text-center fade-in">
                <div class="bg-gray-900 rounded-2xl p-8 shadow-xl hover-lift">
                    <h3 class="text-3xl font-semibold gold-gradient mb-4">Quality</h3>
                    <p class="text-gray-400">Hand-selected instruments and accessories for superior sound.</p>
                </div>
                <div class="bg-gray-900 rounded-2xl p-8 shadow-xl hover-lift">
                    <h3 class="text-3xl font-semibold gold-gradient mb-4">Expertise</h3>
                    <p class="text-gray-400">Our team of passionate musicians is here to guide you.</p>
                </div>
                <div class="bg-gray-900 rounded-2xl p-8 shadow-xl hover-lift">
                    <h3 class="text-3xl font-semibold gold-gradient mb-4">Community</h3>
                    <p class="text-gray-400">Join a family of artists dedicated to the craft of music.</p>
                </div>
            </div>
        </section>

        <!-- Featured Instruments Carousel (Using Hardcoded data for aesthetics) -->
        <section class="container mx-auto py-24 px-6 md:px-12 fade-in">
            <h2 class="text-5xl font-bold text-center cinzel-font gold-gradient mb-12">Featured Instruments</h2>
            <div class="relative">
                <div id="carousel" class="flex overflow-x-auto no-scrollbar space-x-6 pb-4 scroll-smooth">
                    <!-- Carousel Item 1 -->
                    <div class="flex-none bg-gray-900 rounded-2xl p-6 shadow-xl w-72 hover-lift">
                        <img src="https://kraftmusic.com/cdn/shop/files/YAM-MONTAGEM8X_reartopleft.jpg?v=1696873027&width=3000" alt="Yamaha Montage" class="w-full h-48 object-cover rounded-xl mb-4">
                        <h4 class="text-xl font-bold text-white mb-2">Yamaha Montage M8x</h4>
                        <p class="text-sm text-gray-300 mb-4">The centerpiece of any stage, premium voices and professional feel.</p>
                        <div class="flex items-center justify-between">
                            <span class="text-xl font-bold gold-gradient">GHS 60,000</span>
                            <button class="bg-yellow-600 text-black font-semibold py-2 px-4 rounded-full text-sm hover:bg-white hover:text-black transition-colors duration-300">View</button>
                        </div>
                    </div>
                    <!-- Carousel Item 2 -->
                    <div class="flex-none bg-gray-900 rounded-2xl p-6 shadow-xl w-72 hover-lift">
                        <img src="https://www.sweelee.com.sg/cdn/shop/products/N10-10641_1563521017601_1200x1200.jpg?v=1569334145" alt="Nord Stage 4" class="w-full h-48 object-cover rounded-xl mb-4">
                        <h4 class="text-xl font-bold text-white mb-2">Nord Stage 4</h4>
                        <p class="text-sm text-gray-300 mb-4">A timeless blend of tone, aesthetics anf function.</p>
                        <div class="flex items-center justify-between">
                            <span class="text-xl font-bold gold-gradient">GHS 75,000</span>
                            <button class="bg-yellow-600 text-black font-semibold py-2 px-4 rounded-full text-sm hover:bg-white hover:text-black transition-colors duration-300">View</button>
                        </div>
                    </div>
                    <!-- Carousel Item 3 -->
                    <div class="flex-none bg-gray-900 rounded-2xl p-6 shadow-xl w-72 hover-lift">
                        <img src="https://media.musicarts.com/is/image/MMGS7/L52976000003000-00-2000x2000.jpg" alt="Marcus Miller M2 5-string Bass Guitar" class="w-full h-48 object-cover rounded-xl mb-4">
                        <h4 class="text-xl font-bold text-white mb-2">Marcus Miller M2</h4>
                        <p class="text-sm text-gray-300 mb-4">Feel the rhythm with this powerful bass.</p>
                        <div class="flex items-center justify-between">
                            <span class="text-xl font-bold gold-gradient">GHS 15,000</span>
                            <button class="bg-yellow-600 text-black font-semibold py-2 px-4 rounded-full text-sm hover:bg-white hover:text-black transition-colors duration-300">View</button>
                        </div>
                    </div>
                </div>
                <!-- Carousel Navigation -->
                <button onclick="scrollCarousel(-1)" class="absolute top-1/2 left-0 -translate-y-1/2 bg-gray-800 p-2 rounded-full text-yellow-500 shadow-xl opacity-75 hover:opacity-100 transition-opacity">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <button onclick="scrollCarousel(1)" class="absolute top-1/2 right-0 -translate-y-1/2 bg-gray-800 p-2 rounded-full text-yellow-500 shadow-xl opacity-75 hover:opacity-100 transition-opacity">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>
        </section>
    </div>

    <!-- ==================================== -->
    <!-- 2. SHOP PAGE CONTENT -->
    <!-- ==================================== -->
    <div id="shop-page" class="page-content">
        <section class="container mx-auto py-16 px-6 md:px-12 fade-in">
            <h2 class="text-5xl font-bold text-center cinzel-font gold-gradient mb-12">Our Instruments</h2>
            
            <!-- Loading Indicator -->
            <div id="loading-indicator" class="flex justify-center items-center py-20 hidden">
                <div class="loader"></div>
                <p class="ml-4 text-xl text-gray-400">Loading inventory from Supabase...</p>
            </div>
            
            <!-- TOP FILTER BAR: Categories Navigation Only -->
            <div class="bg-gray-900 rounded-2xl p-6 mb-12 shadow-2xl">
                <!-- Category Navigation -->
                <nav>
                    <h3 class="text-lg font-bold text-yellow-500 mb-2">Jump to Category</h3>
                    <div class="flex overflow-x-auto no-scrollbar pb-2 space-x-3" id="category-nav-links">
                        <!-- Category links populated by JS -->
                    </div>
                </nav>
            </div>
            
            <!-- Main Product Content Area (full width) -->
            <div id="product-list" class="w-full">
                <!-- Product groups will be dynamically generated and populated here -->
                <div id="product-groups-container">
                    <!-- Content generated by renderProducts() -->
                </div>
            </div>
        </section>
    </div>

    <!-- ==================================== -->
    <!-- 3. CONTACT PAGE CONTENT -->
    <!-- ==================================== -->
    <div id="contact-page" class="page-content">
        <section class="container mx-auto py-16 px-6 md:px-12 fade-in">
            <h2 class="text-5xl font-bold text-center cinzel-font gold-gradient mb-12">Contact Us</h2>
            <div class="flex flex-col lg:flex-row items-center lg:space-x-12">
                <!-- Contact Form -->
                <div class="bg-gray-900 rounded-2xl p-8 shadow-xl w-full lg:w-1/2">
                    <form id="contact-form" onsubmit="handleFormSubmit(event)">
                        <div class="mb-6">
                            <label for="name" class="block text-gray-300 font-semibold mb-2">Name</label>
                            <input type="text" id="name" name="name" class="w-full px-4 py-2 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                        </div>
                        <div class="mb-6">
                            <label for="email" class="block text-gray-300 font-semibold mb-2">Email</label>
                            <input type="email" id="email" name="email" class="w-full px-4 py-2 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                        </div>
                        <div class="mb-6">
                            <label for="message" class="block text-gray-300 font-semibold mb-2">Message</label>
                            <textarea id="message" name="message" rows="5" class="w-full px-4 py-2 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500" required></textarea>
                        </div>
                        <button type="submit" class="w-full px-6 py-3 font-bold text-black bg-yellow-600 rounded-full shadow-lg hover:bg-white hover:text-black transition-colors duration-300 hover-lift">Send Message</button>
                    </form>
                    <div id="contact-form-message" class="mt-6 text-center hidden p-3 rounded-lg font-medium"></div>
                </div>
                <!-- Contact Info -->
                <div class="w-full lg:w-1/2 mt-12 lg:mt-0 space-y-8">
                    <div class="bg-gray-900 rounded-2xl p-8 shadow-xl">
                        <h4 class="text-2xl font-semibold text-yellow-500 mb-4">Our Store</h4>
                        <p class="text-gray-400">Afariwaa Junction, Tema, Ghana</p>
                    </div>
                    <div class="bg-gray-900 rounded-2xl p-8 shadow-xl">
                        <h4 class="text-2xl font-semibold text-yellow-500 mb-4">Call Us</h4>
                        <p class="text-gray-400">0541096002</p>
                    </div>
                    <div class="bg-gray-900 rounded-2xl p-8 shadow-xl">
                        <h4 class="text-2xl font-semibold text-yellow-500 mb-4">Email Us</h4>
                        <p class="text-gray-400">info@senkufiemusic.com</p>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- ==================================== -->
    <!-- 4. ADMIN PRODUCT ENTRY PAGE CONTENT -->
    <!-- ==================================== -->
    <div id="admin-page" class="page-content">
        <section class="container mx-auto py-16 px-6 md:px-12 fade-in">
            <h2 class="text-5xl font-bold text-center cinzel-font text-red-500 mb-4">Admin Dashboard</h2>
            <p class="text-center text-gray-400 mb-12">Product Inventory Management (Data is saved to Supabase)</p>
            
            <div class="bg-gray-900 rounded-2xl p-8 shadow-2xl max-w-3xl mx-auto">
                <h3 class="text-3xl font-semibold text-yellow-500 mb-6">Add New Product</h3>
                <form id="product-entry-form" onsubmit="handleAddProduct(event)" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Row 1: ID and Name -->
                    <div class="col-span-1">
                        <label for="product-id" class="block text-gray-300 font-semibold mb-1 text-sm">Product ID (Unique, e.g., lg4, kb5)</label>
                        <input type="text" id="product-id" required class="w-full px-3 py-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    </div>
                    <div class="col-span-1">
                        <label for="product-name" class="block text-gray-300 font-semibold mb-1 text-sm">Product Name</label>
                        <input type="text" id="product-name" required class="w-full px-3 py-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    </div>
                    
                    <!-- Row 2: Category and Price -->
                    <div class="col-span-1">
                        <label for="product-category" class="block text-gray-300 font-semibold mb-1 text-sm">Category</label>
                        <select id="product-category" required class="w-full px-3 py-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <option value="" disabled selected>Select a category...</option>
                        </select>
                    </div>
                    <div class="col-span-1">
                        <label for="product-price" class="block text-gray-300 font-semibold mb-1 text-sm">Price (e.g., GHS 5,000)</label>
                        <input type="text" id="product-price" required class="w-full px-3 py-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    </div>

                    <!-- Row 3: Description and Image URL -->
                    <div class="col-span-full">
                        <label for="product-description" class="block text-gray-300 font-semibold mb-1 text-sm">Description</label>
                        <textarea id="product-description" rows="3" required class="w-full px-3 py-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500"></textarea>
                    </div>
                    <div class="col-span-full">
                        <label for="product-image-url" class="block text-gray-300 font-semibold mb-1 text-sm">Image Source Link (URL)</label>
                        <input type="url" id="product-image-url" placeholder="https://placehold.co/600x400/333/FFD700?text=Product+Image" required class="w-full px-3 py-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    </div>
                    
                    <!-- Submit Button -->
                    <div class="col-span-full pt-6">
                        <button type="submit" class="w-full px-6 py-3 text-lg font-bold text-black bg-green-500 rounded-full shadow-lg hover:bg-green-400 transition-colors duration-300 hover-lift">
                            Add Product to Inventory
                        </button>
                    </div>
                </form>
                <div id="product-form-message" class="mt-6 text-center hidden p-3 rounded-lg font-medium"></div>
            </div>
        </section>
    </div>

    <!-- Footer Section -->
    <footer class="bg-gray-950 text-gray-400 p-8 mt-24">
        <div class="container mx-auto text-center space-y-2">
            <h4 class="text-xl font-bold cinzel-font text-white">Senkufie Music</h4>
            <p>Afariwaa Junction, Tema | 0541096002</p>
            <p class="text-sm">
                &copy; 2024 Senkufie Music. All rights reserved. 
                <span class="mx-2 text-gray-600">|</span> 
                <!-- Hidden Admin Link: This is how the admin page is connected -->
                <a href="#" class="text-yellow-600 hover:text-white transition-colors" onclick="showPage('admin-page', null)">Admin Login</a>
            </p>
        </div>
    </footer>

    <script>
        // =================================================================
        // *** 1. SUPABASE INITIALIZATION ***
        // NOTE: Credentials are now correctly embedded from user input.
        // =================================================================
        const SUPABASE_URL = 'https://zeqaggtkcqruhwstymjk.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcWFnZ3RrY3FydWh3c3R5bWprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNjg4MTYsImV4cCI6MjA3NDk0NDgxNn0.j6DNbFXTr1XB6rzeM2s0Wc6MRmZ4zaVPfaiVjUNC_fg';
        const TABLE_NAME = 'products';

        if (SUPABASE_URL === 'YOUR_SUPABASE_URL_HERE' || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY_HERE') {
            console.error("FATAL ERROR: Please update SUPABASE_URL and SUPABASE_ANON_KEY with your credentials to enable database persistence.");
        }
        
        // Initialize the Supabase Client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Global variable to hold the fetched product data
        let productData = [];
        
        // Offset to account for the fixed header height
        const HEADER_OFFSET = 96; 
        
        // Map of Category IDs to user-friendly names 
        const categoryMap = [
            { id: 'lead-guitars-section', name: 'Lead Guitars' },
            { id: 'bass-guitars-section', name: 'Bass Guitars' },
            { id: 'keyboards-section', name: 'Keyboards' },
            { id: 'drums-section', name: 'Drums' },
            { id: 'combos-section', name: 'Combos' },
            { id: 'amplifiers-section', name: 'Amplifiers' },
            { id: 'monitors-section', name: 'Monitors (Active & Passive)' },
            { id: 'line-arrays-section', name: 'Line Arrays' },
            { id: 'mixers-section', name: 'Mixers (Digital & Analog)' },
        ];


        // =================================================================
        // *** 2. SUPABASE DATA OPERATIONS ***
        // =================================================================

        /**
         * Fetches all products from the Supabase 'products' table.
         * Updates the global productData array and re-renders the shop.
         */
        async function fetchProducts() {
            const loadingIndicator = document.getElementById('loading-indicator');
            loadingIndicator.classList.remove('hidden');

            try {
                const { data, error } = await supabase
                    .from(TABLE_NAME)
                    .select('*');

                if (error) {
                    throw new Error(error.message);
                }

                // Log the successful fetch to help confirm connection
                console.log(`Supabase Connection Success: Fetched ${data.length} products.`);

                // Update the global state with fetched data
                productData = data || [];
                renderProducts();
                
            } catch (error) {
                console.error("Error fetching products from Supabase:", error.message);
                // Fallback or error message for user
                const listContainer = document.getElementById('product-groups-container');
                listContainer.innerHTML = '<p class="text-red-400 text-center text-lg mt-10">Could not load inventory. Check console for Supabase errors and credentials.</p>';
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        /**
         * Adds a new product object to the Supabase 'products' table.
         * @param {Object} product - The product object to insert.
         */
        async function addProductToSupabase(product) {
            // Note: Supabase is case-sensitive and expects 'imageURL' to match the database column.
            const { error } = await supabase
                .from(TABLE_NAME)
                .insert([product]);

            if (error) {
                // Throw the error to be caught in handleAddProduct for better reporting
                throw new Error(error.message);
            }
        }
        
        // =================================================================
        // *** 3. ADMIN FORM LOGIC ***
        // =================================================================

        /**
         * Populates the category dropdown on the admin page.
         */
        function populateCategoryDropdown() {
            const dropdown = document.getElementById('product-category');
            if (!dropdown) return;

            categoryMap.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                dropdown.appendChild(option);
            });
        }
        
        /**
         * Handles the submission of the new product form, saves to Supabase, and refreshes the list.
         */
        async function handleAddProduct(event) {
            event.preventDefault();

            const form = document.getElementById('product-entry-form');
            const messageBox = document.getElementById('product-form-message');
            
            // Collect data from form inputs
            const newProduct = {
                id: document.getElementById('product-id').value.trim(),
                name: document.getElementById('product-name').value.trim(),
                category: document.getElementById('product-category').value,
                price: document.getElementById('product-price').value.trim(),
                description: document.getElementById('product-description').value.trim(),
                imageURL: document.getElementById('product-image-url').value.trim(), 
            };

            // Basic validation: Check for ID uniqueness (local check)
            const isIdDuplicate = productData.some(p => p.id === newProduct.id);
            if (isIdDuplicate) {
                messageBox.className = 'mt-6 text-center p-3 rounded-lg font-medium bg-red-800 text-red-300 block';
                messageBox.textContent = `Error: Product ID "${newProduct.id}" already exists. Please choose a unique ID.`;
                setTimeout(() => messageBox.classList.add('hidden'), 5000);
                return;
            }

            try {
                // Add new product to Supabase
                await addProductToSupabase(newProduct);

                // Fetch and re-render the shop page to display the new item
                await fetchProducts(); 

                // Provide success feedback
                messageBox.className = 'mt-6 text-center p-3 rounded-lg font-medium bg-green-800 text-green-300 block';
                messageBox.textContent = `Success! Product "${newProduct.name}" added to inventory and saved to Supabase.`;

                // Clear form and hide message after a few seconds
                form.reset();
            } catch (error) {
                // --- ENHANCED ERROR REPORTING ---
                console.error("Supabase Write Error:", error.message);
                
                let userMessage = `Database Error: Could not save product. ⚠️ Check your Supabase RLS (Row Level Security) and table schema.`;
                
                if (error.message.includes('permission denied')) {
                     userMessage = `SECURITY ERROR: Insert failed due to 'permission denied'. You must enable the INSERT policy on the 'products' table in Supabase RLS.`;
                } else if (error.message.includes('violates not-null constraint')) {
                     userMessage = `SCHEMA ERROR: A required field is empty or missing. Check your table's NOT NULL constraints.`;
                } else if (error.message.includes('duplicate key value')) {
                     userMessage = `ID ERROR: The unique Product ID already exists in the database.`;
                }
                
                messageBox.className = 'mt-6 text-center p-3 rounded-lg font-medium bg-red-800 text-red-300 block';
                messageBox.textContent = userMessage;
            }

            setTimeout(() => messageBox.classList.add('hidden'), 10000); // Keep error visible longer
        }

        // =================================================================
        // *** 4. RENDERING FUNCTIONS ***
        // =================================================================

        /**
         * Generates the HTML string for a single product card.
         */
        function generateProductCard(product) {
            const imageUrl = product.imageURL;
            
            return `
                <div id="product-${product.id}" class="bg-gray-900 rounded-2xl p-6 shadow-xl transition-transform duration-300 hover-lift product-card fade-in">
                    <img src="${imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/333/666?text=Image+Missing'" alt="${product.name}" class="w-full h-48 object-cover rounded-xl mb-4">
                    <h4 class="text-2xl font-bold text-white mb-2 product-name">${product.name}</h4>
                    <p class="text-gray-300 mb-4 product-description">${product.description}</p>
                    <div class="flex items-center justify-between">
                        <span class="text-2xl font-bold gold-gradient">${product.price}</span>
                        <button class="bg-yellow-600 text-black font-semibold py-2 px-6 rounded-full hover:bg-white hover:text-black transition-colors duration-300">Add to Cart</button>
                    </div>
                </div>
            `;
        }

        /**
         * Iterates through the global productData and injects cards into the correct category sections.
         */
        function renderProducts() {
            const container = document.getElementById('product-groups-container');
            if (!container) return;
            
            container.innerHTML = ''; // Clear previous groups

            // 1. Group products by category ID
            const groupedProducts = productData.reduce((acc, product) => {
                if (!acc[product.category]) {
                    acc[product.category] = [];
                }
                acc[product.category].push(product);
                return acc;
            }, {});

            // 2. Iterate through defined categories and render the group HTML
            categoryMap.forEach(category => {
                const products = groupedProducts[category.id];
                if (products && products.length > 0) {
                    let productsHtml = '';
                    products.forEach(product => {
                        productsHtml += generateProductCard(product);
                    });

                    const groupHtml = `
                        <div id="${category.id}" class="mb-16 product-group pt-4 -mt-4">
                            <h3 class="text-4xl font-semibold cinzel-font text-yellow-500 mb-8">${category.name}</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                                ${productsHtml}
                            </div>
                        </div>
                    `;
                    container.innerHTML += groupHtml;
                }
            });
            
            // Re-generate category nav links based on rendered groups
            generateCategoryNav();
        }

        /**
         * Generates and inserts category navigation links dynamically.
         */
        function generateCategoryNav() {
             const navContainer = document.getElementById('category-nav-links');
             navContainer.innerHTML = ''; // Clear existing
             
             categoryMap.forEach(category => {
                 if (document.getElementById(category.id)) {
                     const link = document.createElement('a');
                     link.href = `#${category.id}`;
                     link.className = 'category-link flex-none px-4 py-2 rounded-full text-sm font-medium text-gray-300 bg-gray-800 hover:bg-yellow-600 hover:text-black transition-colors whitespace-nowrap';
                     link.textContent = category.name;
                     link.onclick = handleCategoryScroll;
                     navContainer.appendChild(link);
                 }
             });
        }


        // =================================================================
        // *** 5. GLOBAL UTILITY FUNCTIONS ***
        // =================================================================

        function showPage(pageId, navLink) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            // Show the selected page
            document.getElementById(pageId).style.display = 'block';
            
            // Update active navigation link, skip if no navLink 
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active-link');
            });
            if (navLink) {
                 navLink.classList.add('active-link');
            }
            
            // If we switch to the shop page, ensure we fetch the latest data
            if (pageId === 'shop-page' || pageId === 'admin-page') {
                 // Fetch data on shop and admin page entry
                 fetchProducts(); 
            }

            // Scroll to the top of the new page content
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function handleFormSubmit(event) {
            event.preventDefault(); 
            
            const form = document.getElementById('contact-form');
            // Corrected to target the dedicated contact message div
            const formMessage = document.getElementById('contact-form-message'); 
            
            // Simple display message (no actual sending implemented)
            formMessage.classList.remove('hidden');
            formMessage.className = 'mt-6 text-center p-3 rounded-lg font-medium bg-green-800 text-green-300 block';
            formMessage.textContent = `Thank you for your message! We will get back to you shortly.`;
            
            setTimeout(() => {
                formMessage.classList.add('hidden');
            }, 4000);

            form.reset();
        }

        function scrollCarousel(direction) {
            const carousel = document.getElementById('carousel');
            const scrollAmount = 300; 
            carousel.scrollLeft += direction * scrollAmount;
        }

        function handleCategoryScroll(event) {
            event.preventDefault();
            const targetId = event.target.getAttribute('href');
            const targetElement = document.querySelector(targetId);

            if (targetElement) {
                // Calculate the position to scroll to, factoring in the fixed header offset
                const elementPosition = targetElement.getBoundingClientRect().top + window.scrollY;
                const offsetPosition = elementPosition - HEADER_OFFSET;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });
            }
        }
        
        // Initial page load and setup
        document.addEventListener('DOMContentLoaded', () => {
            // Default to home page
            showPage('home-page', document.querySelector('.nav-link'));

            // Populate the dropdown list with category options for the admin form
            populateCategoryDropdown();
            
            // Fetch initial product data when the app starts
            fetchProducts();
        });
    </script>
</body>
</html>
